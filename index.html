<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checador Jeeapcel - Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #eef3f8;
      padding: 40px;
      text-align: center;
    }

    h2, h3, h4 {
      color: #222;
    }

    form, .panel, .seccion {
      background: white;
      display: inline-block;
      padding: 20px;
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      text-align: left;
      max-width: 500px;
    }

    input, select, textarea {
      padding: 8px;
      margin-top: 5px;
      width: 100%;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      padding: 10px 20px;
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }

    button:hover {
      background: #005fa3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table, th, td {
      border: 1px solid #ccc;
    }

    th, td {
      padding: 10px;
      text-align: center;
    }

    #mensaje {
      margin-top: 20px;
      font-size: 1.1em;
    }

    .seccion {
      display: none;
    }
  </style>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabase = createClient(
      'https://mubtfuksnxtbjxrrwzqh.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11YnRmdWtzbnh0Ymp4cnJ3enFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2Njc0OTcsImV4cCI6MjA2NDI0MzQ5N30.B7ZyBG2g4hCfdI2A2aX852icnHb_JPpfc0VyO0Zr4PA'
    );

    window.addEventListener('DOMContentLoaded', () => {
            const loginForm = document.getElementById('loginForm');
      const loginTitle = document.getElementById('loginTitle');
      const adminPanel = document.getElementById('adminPanel');
      const empleadoPanel = document.getElementById('empleadoPanel');
      const mensaje = document.getElementById('mensaje');
      const cerrarSesion = document.getElementById('cerrarSesion');
      const cerrarSesionEmpleado = document.getElementById('cerrarSesionEmpleado');
      const bienvenida = document.getElementById('bienvenida');
      const accionesEmpleado = document.getElementById('accionesEmpleado');
      const seleccionarSucursal = document.getElementById('seleccionSucursal');

      const secciones = {
        crear: document.getElementById('seccionCrear'),
        verUsuarios: document.getElementById('seccionUsuarios'),
        checadas: document.getElementById('seccionChecadas'),
        aviso: document.getElementById('seccionAviso'),
        reporte: document.getElementById('seccionReporte')
      };

      adminPanel.style.display = 'none';
      empleadoPanel.style.display = 'none';
      cerrarSesion.style.display = 'none';
      cerrarSesionEmpleado.style.display = 'none';

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const nombre = document.getElementById('nombre').value.trim();
        const nip = document.getElementById('nip').value.trim();

        const { data, error } = await supabase
          .from('usuarios')
          .select('*')
          .eq('nombre', nombre)
          .eq('nip', nip)
          .eq('activo', true)
          .single();

        if (error || !data) {
          mensaje.textContent = '❌ Usuario o NIP incorrecto';
        } else {
          mensaje.textContent = `✅ Bienvenido, ${data.nombre} | Rol: ${data.rol}`;
          loginForm.style.display = 'none';
          loginTitle.textContent = '';
          bienvenida.textContent = `Bienvenido, ${data.nombre}`;
          
          if (data.rol === 'admin') {
            adminPanel.style.display = 'block';
            cerrarSesion.style.display = 'inline-block';
          } else if (data.rol === 'empleado') {
            empleadoPanel.style.display = 'block';
            seleccionarSucursal.style.display = 'block';
            cerrarSesionEmpleado.style.display = 'inline-block';

            document.getElementById('confirmarSucursal').addEventListener('click', async () => {
              const sucursal = document.getElementById('sucursalEmpleado').value;
              if (!sucursal) {
                mensaje.textContent = '⚠️ Selecciona una sucursal';
                return;
              }
              await supabase.from('usuarios').update({ sucursal: sucursal }).eq('id', data.id);
              seleccionarSucursal.style.display = 'none';
              accionesEmpleado.style.display = 'block';
              mensaje.textContent = `🏪 Sucursal seleccionada: ${sucursal}`;
            });
          }
        }
      });

      cerrarSesion.addEventListener('click', () => location.reload());
      cerrarSesionEmpleado.addEventListener('click', () => location.reload());
            // Llenar select de empleados activos para filtro en admin
      async function cargarEmpleados() {
        const { data } = await supabase.from('usuarios').select('nombre').eq('activo', true);
        const select = document.getElementById('filtroNombre');
        select.innerHTML = '<option value="">Todos</option>';
        data.forEach(user => {
          const option = document.createElement('option');
          option.value = user.nombre;
          option.textContent = user.nombre;
          select.appendChild(option);
        });
      }
      cargarEmpleados();

      // Buscar checadas por fecha, nombre o sucursal
      document.getElementById('formFecha').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fecha = document.getElementById('fechaBuscada').value;
        const nombre = document.getElementById('filtroNombre').value;
        const sucursal = document.getElementById('filtroSucursal').value;

        let query = supabase.from('usuarios').select('*')
          .gte('ultima_entrada', fecha + 'T00:00:00')
          .lte('ultima_entrada', fecha + 'T23:59:59');

        if (nombre) query = query.eq('nombre', nombre);
        if (sucursal) query = query.eq('sucursal', sucursal);

        const { data } = await query;
        const tabla = document.getElementById('tablaChecadas');
        tabla.innerHTML = '<tr><th>Nombre</th><th>Rol</th><th>Sucursal</th><th>Hora de entrada</th></tr>';
        data.forEach(user => {
          const fila = document.createElement('tr');
          fila.innerHTML = `<td>${user.nombre}</td><td>${user.rol}</td><td>${user.sucursal || '-'}</td><td>${new Date(user.ultima_entrada).toLocaleTimeString()}</td>`;
          tabla.appendChild(fila);
        });
      });

      // Check In
      document.getElementById('btnCheckIn').addEventListener('click', async () => {
        const nombre = bienvenida.textContent.replace('Bienvenido, ', '');
        await supabase.from('usuarios').update({ ultima_entrada: new Date().toISOString() }).eq('nombre', nombre);
        mensaje.textContent = '✅ Check In registrado';
      });

      // Check Out
      document.getElementById('btnCheckOut').addEventListener('click', async () => {
        const nombre = bienvenida.textContent.replace('Bienvenido, ', '');
        await supabase.from('usuarios').update({ ultima_salida: new Date().toISOString() }).eq('nombre', nombre);
        mensaje.textContent = '✅ Check Out registrado';
      });
          <div id="seccionChecadas" class="seccion">
      <h4>📅 Checadas por fecha</h4>
      <form id="formFecha">
        <input type="date" id="fechaBuscada" required>
        <select id="filtroNombre">
          <option value="">Todos los empleados</option>
        </select>
        <select id="filtroSucursal">
          <option value="">Todas las sucursales</option>
          <option value="A">Sucursal A</option>
          <option value="B">Sucursal B</option>
          <option value="C">Sucursal C</option>
          <option value="D">Sucursal D</option>
          <option value="E">Sucursal E</option>
          <option value="F">Sucursal F</option>
        </select>
        <button type="submit">Buscar</button>
      </form>
      <table id="tablaChecadas"></table>
    </div>

    <!-- Panel empleado -->
    <div class="panel" id="empleadoPanel" style="display: none;">
      <h3>🙋 Panel de empleado</h3>
      <h4 id="sucursalTitulo">Selecciona tu sucursal</h4>
      <select id="sucursalEmpleado">
        <option value="">Selecciona...</option>
        <option value="A">Sucursal A</option>
        <option value="B">Sucursal B</option>
        <option value="C">Sucursal C</option>
        <option value="D">Sucursal D</option>
        <option value="E">Sucursal E</option>
        <option value="F">Sucursal F</option>
      </select>
      <button onclick="guardarSucursal()">Guardar Sucursal</button>

      <div id="accionesEmpleado" style="display:none; margin-top:20px;">
        <button id="btnCheckIn">✅ Check In</button>
        <button id="btnCheckOut">⛔ Check Out</button>
      </div>
    </div>
      <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://mubtfuksnxtbjxrrwzqh.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11YnRmdWtzbnh0Ymp4cnJ3enFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2Njc0OTcsImV4cCI6MjA2NDI0MzQ5N30.B7ZyBG2g4hCfdI2A2aX852icnHb_JPpfc0VyO0Zr4PA'
    );

    let usuarioActual = null;

    window.addEventListener('DOMContentLoaded', () => {
      // ... (todo lo anterior)

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const nombre = document.getElementById('nombre').value.trim();
        const nip = document.getElementById('nip').value.trim();

        const { data, error } = await supabase
          .from('usuarios')
          .select('*')
          .eq('nombre', nombre)
          .eq('nip', nip)
          .eq('activo', true)
          .single();

        if (error || !data) {
          mensaje.textContent = '❌ Usuario o NIP incorrecto';
        } else {
          usuarioActual = data;
          mensaje.textContent = `✅ Bienvenido, ${data.nombre} | Rol: ${data.rol}`;
          loginForm.style.display = 'none';
          loginTitle.textContent = '';
          cerrarSesion.style.display = 'inline-block';
          bienvenida.textContent = `Bienvenido, ${data.nombre}`;

          if (data.rol === 'admin') {
            adminPanel.style.display = 'block';
          } else if (data.rol === 'empleado') {
            document.getElementById('empleadoPanel').style.display = 'block';
          }
        }
      });

      document.getElementById('btnCheckIn').addEventListener('click', async () => {
        if (!usuarioActual || !usuarioActual.sucursal) {
          alert('Selecciona tu sucursal primero');
          return;
        }

        await supabase.from('checadas').insert([
          {
            usuario_id: usuarioActual.id,
            nombre: usuarioActual.nombre,
            sucursal: usuarioActual.sucursal,
            tipo: 'entrada',
            hora: new Date().toISOString()
          }
        ]);
        mensaje.textContent = '✅ Check In registrado';
      });

      document.getElementById('btnCheckOut').addEventListener('click', async () => {
        if (!usuarioActual || !usuarioActual.sucursal) {
          alert('Selecciona tu sucursal primero');
          return;
        }

        await supabase.from('checadas').insert([
          {
            usuario_id: usuarioActual.id,
            nombre: usuarioActual.nombre,
            sucursal: usuarioActual.sucursal,
            tipo: 'salida',
            hora: new Date().toISOString()
          }
        ]);
        mensaje.textContent = '⛔ Check Out registrado';
      });

      window.guardarSucursal = async () => {
        const sucursal = document.getElementById('sucursalEmpleado').value;
        if (!sucursal) return alert('Selecciona una sucursal');

        await supabase
          .from('usuarios')
          .update({ sucursal })
          .eq('id', usuarioActual.id);

        usuarioActual.sucursal = sucursal;
        document.getElementById('sucursalTitulo').textContent = `Sucursal: ${sucursal}`;
        document.getElementById('sucursalEmpleado').style.display = 'none';
        document.querySelector('#empleadoPanel button[onclick="guardarSucursal()"]').style.display = 'none';
        document.getElementById('accionesEmpleado').style.display = 'block';
      };
            document.getElementById('formFecha').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fecha = document.getElementById('fechaBuscada').value;
        const filtroNombre = document.getElementById('filtroNombre').value;
        const filtroSucursal = document.getElementById('filtroSucursal').value;

        let query = supabase.from('checadas').select('*');
        if (fecha) {
          query = query
            .gte('hora', fecha + 'T00:00:00')
            .lte('hora', fecha + 'T23:59:59');
        }
        if (filtroNombre) {
          query = query.eq('nombre', filtroNombre);
        }
        if (filtroSucursal) {
          query = query.eq('sucursal', filtroSucursal);
        }

        const { data } = await query.order('hora', { ascending: true });

        const tabla = document.getElementById('tablaChecadas');
        tabla.innerHTML = '<tr><th>Nombre</th><th>Sucursal</th><th>Tipo</th><th>Hora</th></tr>';
        data.forEach(row => {
          const fila = document.createElement('tr');
          fila.innerHTML = `
            <td>${row.nombre}</td>
            <td>${row.sucursal}</td>
            <td>${row.tipo === 'entrada' ? '✅ Entrada' : '⛔ Salida'}</td>
            <td>${new Date(row.hora).toLocaleString()}</td>
          `;
          tabla.appendChild(fila);
        });
      });

      async function cargarNombresChecadas() {
        const { data } = await supabase.from('usuarios').select('nombre').eq('activo', true);
        const filtro = document.getElementById('filtroNombre');
        filtro.innerHTML = '<option value="">Todos</option>';
        data.forEach(u => {
          const option = document.createElement('option');
          option.value = u.nombre;
          option.textContent = u.nombre;
          filtro.appendChild(option);
        });
      }

      cargarNombresChecadas();
        <div class="panel" id="empleadoPanel" style="display: none;">
    <h3>🕒 Panel del Empleado</h3>
    <p id="bienvenidaEmpleado"></p>
    <label for="selectorSucursal">Selecciona tu sucursal:</label>
    <select id="selectorSucursal" required>
      <option value="">Selecciona...</option>
      <option value="A">Sucursal A</option>
      <option value="B">Sucursal B</option>
      <option value="C">Sucursal C</option>
      <option value="D">Sucursal D</option>
      <option value="E">Sucursal E</option>
      <option value="F">Sucursal F</option>
    </select><br><br>

    <button id="btnCheckIn">✅ Check In</button>
    <button id="btnCheckOut">⛔ Check Out</button>
    <button id="cerrarSesionEmpleado">🔓 Cerrar sesión</button>

    <div id="mensajeEmpleado"></div>
  </div>
    <script type="module">
// ... (código anterior dentro de DOMContentLoaded)

// Referencias a elementos del panel de empleado
const empleadoPanel = document.getElementById('empleadoPanel');
const bienvenidaEmpleado = document.getElementById('bienvenidaEmpleado');
const selectorSucursal = document.getElementById('selectorSucursal');
const mensajeEmpleado = document.getElementById('mensajeEmpleado');
const btnCheckIn = document.getElementById('btnCheckIn');
const btnCheckOut = document.getElementById('btnCheckOut');
const cerrarSesionEmpleado = document.getElementById('cerrarSesionEmpleado');

let usuarioActual = null;

// Después del login exitoso:
if (data.rol === 'empleado') {
  usuarioActual = data;
  loginForm.style.display = 'none';
  loginTitle.textContent = '';
  cerrarSesionEmpleado.style.display = 'inline-block';
  empleadoPanel.style.display = 'block';
  bienvenidaEmpleado.textContent = `Hola ${data.nombre}, selecciona tu sucursal y registra tu entrada o salida.`;
}

// Funciones Check In / Check Out
btnCheckIn.addEventListener('click', async () => {
  const sucursal = selectorSucursal.value;
  if (!sucursal) {
    mensajeEmpleado.textContent = '⚠️ Selecciona una sucursal antes de registrar.';
    return;
  }

  const { error } = await supabase.from('checadas').insert([{
    nombre: usuarioActual.nombre,
    rol: usuarioActual.rol,
    sucursal,
    tipo: 'entrada',
    hora: new Date().toISOString()
  }]);

  mensajeEmpleado.textContent = error ? '❌ Error al registrar entrada' : '✅ Entrada registrada';
});

btnCheckOut.addEventListener('click', async () => {
  const sucursal = selectorSucursal.value;
  if (!sucursal) {
    mensajeEmpleado.textContent = '⚠️ Selecciona una sucursal antes de registrar.';
    return;
  }

  const { error } = await supabase.from('checadas').insert([{
    nombre: usuarioActual.nombre,
    rol: usuarioActual.rol,
    sucursal,
    tipo: 'salida',
    hora: new Date().toISOString()
  }]);

  mensajeEmpleado.textContent = error ? '❌ Error al registrar salida' : '✅ Salida registrada';
});

// Cerrar sesión del empleado
cerrarSesionEmpleado.addEventListener('click', () => location.reload());
    // Dentro de DOMContentLoaded, reemplaza el listener del formFecha con este nuevo código:
document.getElementById('formFecha').addEventListener('submit', async (e) => {
  e.preventDefault();
  const fecha = document.getElementById('fechaBuscada').value;
  const filtroEmpleado = document.getElementById('filtroEmpleado').value;
  const filtroSucursal = document.getElementById('filtroSucursal').value;

  let query = supabase.from('checadas').select('*')
    .gte('hora', fecha + 'T00:00:00')
    .lte('hora', fecha + 'T23:59:59');

  if (filtroEmpleado && filtroEmpleado !== 'todos') {
    query = query.eq('nombre', filtroEmpleado);
  }

  if (filtroSucursal && filtroSucursal !== 'todas') {
    query = query.eq('sucursal', filtroSucursal);
  }

  const { data, error } = await query;

  const tabla = document.getElementById('tablaChecadas');
  tabla.innerHTML = '<tr><th>Nombre</th><th>Rol</th><th>Sucursal</th><th>Tipo</th><th>Hora</th></tr>';

  if (error) {
    tabla.innerHTML += `<tr><td colspan="5">❌ Error al cargar datos</td></tr>`;
    return;
  }

  data.forEach(row => {
    const fila = document.createElement('tr');
    fila.innerHTML = `
      <td>${row.nombre}</td>
      <td>${row.rol}</td>
      <td>${row.sucursal}</td>
      <td>${row.tipo === 'entrada' ? '🟢 Entrada' : '🔴 Salida'}</td>
      <td>${new Date(row.hora).toLocaleString()}</td>
    `;
    tabla.appendChild(fila);
  });
});
        <!-- Sección checadas con filtros -->
    <div id="seccionChecadas" class="seccion">
      <h4>📅 Checadas por fecha</h4>
      <form id="formFecha">
        <input type="date" id="fechaBuscada" required>
        <select id="filtroSucursal">
          <option value="todas">Todas las sucursales</option>
          <option value="A">Sucursal A</option>
          <option value="B">Sucursal B</option>
          <option value="C">Sucursal C</option>
          <option value="D">Sucursal D</option>
          <option value="E">Sucursal E</option>
          <option value="F">Sucursal F</option>
        </select>
        <select id="filtroEmpleado">
          <option value="todos">Todos los empleados</option>
        </select>
        <button type="submit">Buscar</button>
      </form>
      <table id="tablaChecadas"></table>
    </div>

    <script type="module">
      import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

      const supabase = createClient(
        'https://mubtfuksnxtbjxrrwzqh.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11YnRmdWtzbnh0Ymp4cnJ3enFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2Njc0OTcsImV4cCI6MjA2NDI0MzQ5N30.B7ZyBG2g4hCfdI2A2aX852icnHb_JPpfc0VyO0Zr4PA'
      );

      async function cargarEmpleadosParaFiltro() {
        const { data, error } = await supabase
          .from('usuarios')
          .select('nombre')
          .eq('activo', true)
          .eq('rol', 'empleado');

        const filtroEmpleado = document.getElementById('filtroEmpleado');
        filtroEmpleado.innerHTML = '<option value="todos">Todos los empleados</option>';

        if (!error && data) {
          data.forEach(emp => {
            const option = document.createElement('option');
            option.value = emp.nombre;
            option.textContent = emp.nombre;
            filtroEmpleado.appendChild(option);
          });
        }
      }

      window.addEventListener('DOMContentLoaded', () => {
        cargarEmpleadosParaFiltro();
      });
    </script>
        <script type="module">
      // Ya está importado el supabase y cargando filtro empleados en Parte 11

      document.getElementById('formFecha').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fecha = document.getElementById('fechaBuscada').value;
        const sucursal = document.getElementById('filtroSucursal').value;
        const empleado = document.getElementById('filtroEmpleado').value;

        let query = supabase.from('checadas').select('*')
          .gte('entrada', fecha + 'T00:00:00')
          .lte('entrada', fecha + 'T23:59:59');

        if (sucursal !== 'todas') {
          query = query.eq('sucursal', sucursal);
        }

        if (empleado !== 'todos') {
          query = query.eq('nombre', empleado);
        }

        const { data, error } = await query;

        const tabla = document.getElementById('tablaChecadas');
        tabla.innerHTML = '<tr><th>Nombre</th><th>Sucursal</th><th>Entrada</th><th>Salida</th></tr>';

        if (data && data.length > 0) {
          data.forEach(item => {
            const fila = document.createElement('tr');
            fila.innerHTML = `
              <td>${item.nombre}</td>
              <td>${item.sucursal}</td>
              <td>${item.entrada ? new Date(item.entrada).toLocaleTimeString() : '-'}</td>
              <td>${item.salida ? new Date(item.salida).toLocaleTimeString() : '-'}</td>
            `;
            tabla.appendChild(fila);
          });
        } else {
          const fila = document.createElement('tr');
          fila.innerHTML = '<td colspan="4">No se encontraron checadas</td>';
          tabla.appendChild(fila);
        }
      });
    </script>
        <script type="module">
      // Esta parte extiende el script ya iniciado, asegurando que lo pegas después del bloque anterior o al final del script principal

      // Detectar si el usuario es EMPLEADO
      if (data.rol === 'empleado') {
        const seccionEmpleado = document.createElement('div');
        seccionEmpleado.className = 'panel';
        seccionEmpleado.innerHTML = `
          <h3>👤 Panel de empleado</h3>
          <label for="seleccionSucursal">Selecciona tu sucursal:</label>
          <select id="seleccionSucursal" required>
            <option value="A">Sucursal A</option>
            <option value="B">Sucursal B</option>
            <option value="C">Sucursal C</option>
            <option value="D">Sucursal D</option>
            <option value="E">Sucursal E</option>
            <option value="F">Sucursal F</option>
          </select><br><br>
          <button id="btnCheckIn">🕒 Check In</button>
          <button id="btnCheckOut">✅ Check Out</button>
        `;
        document.body.appendChild(seccionEmpleado);

        const checkIn = document.getElementById('btnCheckIn');
        const checkOut = document.getElementById('btnCheckOut');
        const sucursalInput = document.getElementById('seleccionSucursal');

        checkIn.addEventListener('click', async () => {
          const sucursal = sucursalInput.value;
          const { error } = await supabase.from('checadas').insert([{
            nombre: data.nombre,
            sucursal,
            entrada: new Date().toISOString()
          }]);

          mensaje.textContent = error ? '❌ Error al hacer check-in' : '🕒 Check-in exitoso';
        });

        checkOut.addEventListener('click', async () => {
          const { data: ultima } = await supabase
            .from('checadas')
            .select('*')
            .eq('nombre', data.nombre)
            .order('entrada', { ascending: false })
            .limit(1);

          if (ultima && ultima.length > 0) {
            const id = ultima[0].id;
            const { error } = await supabase
              .from('checadas')
              .update({ salida: new Date().toISOString() })
              .eq('id', id);

            mensaje.textContent = error ? '❌ Error al hacer check-out' : '✅ Check-out exitoso';
          } else {
            mensaje.textContent = '⚠️ No se encontró un check-in previo';
          }
        });
      }LIS
                // Continuación lógica del script principal, puedes pegar esto al final del bloque <script> donde definimos mostrarSeccion

      // Ajuste para mostrar las nuevas checadas desde la tabla 'checadas' en lugar de 'usuarios'
      document.getElementById('formFecha').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fecha = document.getElementById('fechaBuscada').value;
        const empleadoFiltro = document.getElementById('filtroEmpleado')?.value;
        const sucursalFiltro = document.getElementById('filtroSucursal')?.value;

        let query = supabase
          .from('checadas')
          .select('*')
          .gte('entrada', fecha + 'T00:00:00')
          .lte('entrada', fecha + 'T23:59:59');

        if (empleadoFiltro && empleadoFiltro !== 'todos') {
          query = query.eq('nombre', empleadoFiltro);
        }

        if (sucursalFiltro && sucursalFiltro !== 'todas') {
          query = query.eq('sucursal', sucursalFiltro);
        }

        const { data, error } = await query;

        const tabla = document.getElementById('tablaChecadas');
        tabla.innerHTML = '<tr><th>Nombre</th><th>Sucursal</th><th>Entrada</th><th>Salida</th></tr>';
        data.forEach(row => {
          const fila = document.createElement('tr');
          fila.innerHTML = `
            <td>${row.nombre}</td>
            <td>${row.sucursal}</td>
            <td>${row.entrada ? new Date(row.entrada).toLocaleTimeString() : '-'}</td>
            <td>${row.salida ? new Date(row.salida).toLocaleTimeString() : '-'}</td>
          `;
          tabla.appendChild(fila);
        });

        if (error) {
          mensaje.textContent = '❌ Error al consultar checadas';
        }
      });

      // Cargar lista de empleados en el filtro
      async function cargarFiltroEmpleados() {
        const { data } = await supabase.from('usuarios').select('nombre').eq('activo', true);
        const filtro = document.getElementById('filtroEmpleado');
        filtro.innerHTML = `<option value="todos">Todos</option>`;
        data.forEach(user => {
          const opt = document.createElement('option');
          opt.value = user.nombre;
          opt.textContent = user.nombre;
          filtro.appendChild(opt);
        });
      }
          <!-- Inserta esto dentro de la sección #seccionChecadas, justo antes del botón de Buscar -->
<div style="margin-top: 10px;">
  <label for="filtroEmpleado"><strong>Filtrar por empleado:</strong></label>
  <select id="filtroEmpleado" onchange="cargarFiltroEmpleados()">
    <option value="todos">Todos</option>
    <!-- Se llenará dinámicamente -->
  </select>
</div>

<div style="margin-top: 10px;">
  <label for="filtroSucursal"><strong>Filtrar por sucursal:</strong></label>
  <select id="filtroSucursal">
    <option value="todas">Todas</option>
    <option value="A">Sucursal A</option>
    <option value="B">Sucursal B</option>
    <option value="C">Sucursal C</option>
    <option value="D">Sucursal D</option>
    <option value="E">Sucursal E</option>
    <option value="F">Sucursal F</option>
  </select>
</div>

<script>
  // Cargar empleados al cargar la página para el filtro
  cargarFiltroEmpleados();
</script>
